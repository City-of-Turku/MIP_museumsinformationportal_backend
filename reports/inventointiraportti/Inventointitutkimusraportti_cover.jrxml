<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.3.1.final using JasperReports Library version 6.3.1  -->
<!-- 2020-12-15T12:22:14 -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Wave Cover" pageWidth="595" pageHeight="842" whenNoDataType="AllSectionsNoDetail" columnWidth="595" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="c50b24eb-eb33-413f-8e75-e7e20a5341fd">
	<property name="com.jaspersoft.studio.unit." value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageHeight" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.pageWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.topMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.bottomMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.leftMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.rightMargin" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnWidth" value="pixel"/>
	<property name="com.jaspersoft.studio.unit.columnSpacing" value="pixel"/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="localhost"/>
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<subDataset name="kuva_kansilehti" uuid="dbe1dc2c-51e5-46c4-802f-8399c0abf0ec">
		<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
		<property name="com.jaspersoft.studio.data.defaultdataadapter" value="localhost"/>
		<parameter name="tutkimusraporttiId" class="java.lang.Long"/>
		<parameter name="MIP_BACKEND_URL" class="java.lang.String"/>
		<queryString language="SQL">
			<![CDATA[select k.id, coalesce(k.luettelointinumero, k.otsikko) as otsake
from ark_kuva k
left join ark_tutkimusraportti_kuva atk on atk.ark_kuva_id = k.id
left join ark_tutkimusraportti tr on tr.id = atk.ark_tutkimusraportti_id 
where tr.id = 1
and atk.kappale = 'kansilehti']]>
		</queryString>
		<field name="id" class="java.lang.Long"/>
		<field name="otsake" class="java.lang.String"/>
	</subDataset>
	<parameter name="tutkimusraporttiId" class="java.lang.Long"/>
	<parameter name="MIP_BACKEND_URL" class="java.lang.String"/>
	<queryString>
		<![CDATA[select tr.id, raportti_luoja.etunimi, raportti_luoja.sukunimi, t.nimi as tutkimus_nimi, tkk.kunta, tkk.kyla, t.alkupvm, t.loppupvm
from ark_tutkimusraportti tr
left join ark_tutkimus t on t.id = tr.ark_tutkimus_id
left join kayttaja raportti_luoja on raportti_luoja.id = tr.luoja
left join (
    select tkk.ark_tutkimus_id, string_agg(ku.nimi, ', ') as kunta, string_agg(ky.nimi, ', ') as kyla, string_agg(ku.nimi_se, ', ') as kunta_se, string_agg(ky.nimi_se, ', ') as kyla_se
    from ark_tutkimus_kuntakyla tkk
    left join kunta ku on tkk.kunta_id = ku.id
    left join kyla ky on tkk.kyla_id = ky.id
    group by tkk.ark_tutkimus_id
) tkk on (tkk.ark_tutkimus_id = t.id)
where tr.id = $P{tutkimusraporttiId}]]>
	</queryString>
	<field name="id" class="java.lang.Long"/>
	<field name="etunimi" class="java.lang.String"/>
	<field name="sukunimi" class="java.lang.String"/>
	<field name="tutkimus_nimi" class="java.lang.String"/>
	<field name="kunta" class="java.lang.String"/>
	<field name="kyla" class="java.lang.String"/>
	<field name="alkupvm" class="java.sql.Date"/>
	<field name="loppupvm" class="java.sql.Date"/>
	<title>
		<band height="841" splitType="Stretch">
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement positionType="Float" x="20" y="110" width="557" height="30" isRemoveLineWhenBlank="true" forecolor="#000000" uuid="5bb49d37-ea51-4ca3-a18a-38cb0e66e0ee"/>
				<box leftPadding="20" rightPadding="20"/>
				<textElement textAlignment="Center" verticalAlignment="Bottom">
					<font size="16" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{kunta}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement positionType="Float" x="20" y="652" width="557" height="20" isRemoveLineWhenBlank="true" uuid="38fc9afd-edcb-42f3-b6bc-cd258f6507b3"/>
				<textElement textAlignment="Right">
					<font size="14"/>
				</textElement>
				<textFieldExpression><![CDATA["Turun museokeskus" + "\n" + $F{etunimi} + " " + $F{sukunimi}]]></textFieldExpression>
			</textField>
			<componentElement>
				<reportElement positionType="Float" x="20" y="240" width="557" height="346" uuid="a32676d4-4e4b-4b79-a9ab-791ec337dc95">
					<property name="com.jaspersoft.studio.unit.width" value="pixel"/>
					<property name="net.sf.jasperreports.export.headertoolbar.table.name" value=""/>
				</reportElement>
				<jr:list xmlns:jr="http://jasperreports.sourceforge.net/jasperreports/components" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports/components http://jasperreports.sourceforge.net/xsd/components.xsd" printOrder="Vertical">
					<datasetRun subDataset="kuva_kansilehti" uuid="70a0849b-f48b-49e9-b01e-76bafb330271">
						<datasetParameter name="MIP_BACKEND_URL">
							<datasetParameterExpression><![CDATA[$P{MIP_BACKEND_URL}]]></datasetParameterExpression>
						</datasetParameter>
						<datasetParameter name="tutkimusraporttiId">
							<datasetParameterExpression><![CDATA[$P{tutkimusraporttiId}]]></datasetParameterExpression>
						</datasetParameter>
						<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
					</datasetRun>
					<jr:listContents height="346" width="557">
						<image hAlign="Center" vAlign="Middle" onErrorType="Blank">
							<reportElement x="0" y="0" width="557" height="316" uuid="4e204347-ab39-4ffa-a002-3c84f72a38c7"/>
							<box>
								<pen lineColor="#E3E3E3"/>
								<topPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
								<leftPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
								<bottomPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
								<rightPen lineWidth="0.0" lineStyle="Solid" lineColor="#000000"/>
							</box>
							<imageExpression><![CDATA[$P{MIP_BACKEND_URL} + "/raportti/ark_kuva/"+$F{id}+"/pieni"]]></imageExpression>
						</image>
						<textField>
							<reportElement x="0" y="316" width="557" height="30" uuid="83008f6a-17b4-4047-b5b5-a6ea8641d5cb"/>
							<textFieldExpression><![CDATA[$F{otsake}]]></textFieldExpression>
						</textField>
					</jr:listContents>
				</jr:list>
			</componentElement>
			<staticText>
				<reportElement x="100" y="69" width="400" height="30" uuid="ef191ddd-8b80-4faf-a4ad-ac6fb7fc3838"/>
				<textElement textAlignment="Center">
					<font size="14"/>
				</textElement>
				<text><![CDATA[INVENTOINTIRAPORTTI]]></text>
			</staticText>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement positionType="Float" x="20" y="140" width="557" height="30" isRemoveLineWhenBlank="true" forecolor="#000000" uuid="e4f0d8bc-7854-4524-b39b-36d32d64af8a"/>
				<box leftPadding="20" rightPadding="20"/>
				<textElement textAlignment="Center">
					<font size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{kyla}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement positionType="Float" x="20" y="170" width="557" height="20" isRemoveLineWhenBlank="true" forecolor="#000000" uuid="3597face-4c28-4444-8046-1945ab0ad524"/>
				<box leftPadding="20" rightPadding="20"/>
				<textElement textAlignment="Center">
					<font size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[$F{tutkimus_nimi}]]></textFieldExpression>
			</textField>
			<textField isStretchWithOverflow="true" isBlankWhenNull="true">
				<reportElement positionType="Float" x="20" y="190" width="557" height="20" isRemoveLineWhenBlank="true" forecolor="#000000" uuid="84ca7924-f19d-490c-95e4-a2be580c2bac"/>
				<box leftPadding="20" rightPadding="20"/>
				<textElement textAlignment="Center">
					<font size="14"/>
				</textElement>
				<textFieldExpression><![CDATA[DATEFORMAT($F{alkupvm},"dd.MM.yyyy") + " - " + DATEFORMAT($F{loppupvm},"dd.MM.yyyy")]]></textFieldExpression>
			</textField>
		</band>
	</title>
</jasperReport>
